{"version":3,"sources":["Utils.js","ApplicationBus.js","ApiService.js","NewToDoItemViewModel.js","ToDoListViewModel.js","App.js"],"names":["jQuery","ajax","response","deferred","Deferred","resolve","promise","ko","bindingHandlers","datepicker","init","element","valueAccessor","allBindingsAccessor","options","datepickerOptions","language","format","startDate","moment","add","toDate","clearBtn","todayBtn","autoclose","todayHighlight","initialMoment","$","utils","registerEventHandler","event","value","isObservable","date","update","val","widget","data","unwrapObservable","setValue","this","webapp","ctor","self","newToDoItemAdded","Bacon","Bus","ApplicationBus","fakeItems","Enumerable","cycle","title","description","dueDate","take","union","select","item","i","index","toArray","loadTodoItems","result","from","forEach","push","insertNewToDoItem","newToDoItem","ApiService","apiService","applicationBus","observable","incorrectDueDate","computed","isValid","canInsertNewItem","insertNewItem","newItem","done","error","Error","fail","NewToDoItemViewModel","loadItems","items","observableArray","errorMessage","then","removeAll","onValue","onError","message","ToDoListViewModel","document","ready","viewModel","toDoList","applyBindings"],"mappings":"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","file":"site.min.js","sourcesContent":["//redefinition fake ajax\r\njQuery.ajax = function (response) {\r\n    var deferred = jQuery.Deferred().resolve(response);\r\n    return deferred.promise();\r\n};\r\n\r\nko.bindingHandlers.datepicker = {\r\n    init: function (element, valueAccessor, allBindingsAccessor) {\r\n        var options = allBindingsAccessor().datepickerOptions || {\r\n                language: \"it\",\r\n                format: \"dd/mm/yyyy\",\r\n                startDate: moment().add(1, \"d\").toDate(),\r\n                clearBtn: true,\r\n                todayBtn: \"linked\",\r\n                autoclose: true,\r\n                todayHighlight: true\r\n            },\r\n            initialMoment = valueAccessor();\r\n        $(element).datepicker(options);\r\n        $(element).datepicker(\"setDate\", initialMoment().toDate());\r\n        ko.utils.registerEventHandler(element, \"changeDate\", function (event) {\r\n            var value = valueAccessor();\r\n            if (ko.isObservable(value)) {\r\n                value(moment(event.date));\r\n            }\r\n        });\r\n        ko.utils.registerEventHandler(element, \"clearDate\", function (event) {\r\n            var value = valueAccessor();\r\n            if (ko.isObservable(value)) {\r\n                value(null);\r\n            }\r\n        });\r\n    },\r\n    update: function (element, valueAccessor) {\r\n        var widget = $(element).data(\"datepicker\"),\r\n            val;\r\n        if (widget) {\r\n            val = ko.utils.unwrapObservable(valueAccessor());\r\n            widget.date = val ? val.toDate() : null;\r\n            widget.setValue();\r\n        }\r\n    }\r\n};","this.webapp = (function (webapp) {\r\n    var ctor = function () {\r\n        var self = this;\r\n\r\n        self.newToDoItemAdded = new Bacon.Bus();\r\n    };\r\n    webapp.ApplicationBus = function () {\r\n        return new ctor();\r\n    };\r\n    return webapp;\r\n}(this.webapp || {}));","this.webapp = (function (webapp) {\r\n    var ctor = function () {\r\n        var self = this,\r\n            fakeItems =\r\n                Enumerable.cycle({\r\n                    title: \"Star Wars Rogue One\",\r\n                    description: \"Hype!\",\r\n                    dueDate: moment()\r\n                })\r\n                .take(1)\r\n                .union(\r\n                    Enumerable.cycle({\r\n                        title: \"Todo \",\r\n                        description: \"This is the Todo #\",\r\n                        dueDate: moment()\r\n                    })\r\n                    .take(5)\r\n                    .select(function (item, i) {\r\n                        var index = i += 1;\r\n                        return {\r\n                            title: item.title + index,\r\n                            description: item.description + index,\r\n                            dueDate: item.dueDate\r\n                        };\r\n                    })\r\n                )\r\n                .toArray();\r\n\r\n        self.loadTodoItems = function () {\r\n            var result = [];\r\n            Enumerable.from(fakeItems)\r\n                .forEach(function (item) {\r\n                    result.push(item);\r\n                });\r\n            return jQuery.ajax(result);\r\n        };\r\n\r\n        self.insertNewToDoItem = function (newToDoItem) {\r\n            fakeItems.push(newToDoItem);\r\n            return jQuery.ajax(true);\r\n        };\r\n    };\r\n    webapp.ApiService = function () {\r\n        return new ctor();\r\n    };\r\n    return webapp;\r\n}(this.webapp || {}));","this.webapp = (function (webapp) {\r\n    var ctor = function (apiService, applicationBus) {\r\n        var self = this;\r\n\r\n        self.title = ko.observable(\"\");\r\n        self.description = ko.observable(\"\");\r\n        self.dueDate = ko.observable(moment().add(1, \"d\"));\r\n\r\n        self.incorrectDueDate = ko.computed(function () {\r\n            if (!this.dueDate()) {\r\n                return true;\r\n            }\r\n            return !(this.dueDate().isValid() && (this.dueDate() > moment()));\r\n        }, self);\r\n\r\n        self.canInsertNewItem = ko.computed(function () {\r\n            return this.title() &&\r\n                this.description() &&\r\n                !this.incorrectDueDate();\r\n        }, self);\r\n\r\n        self.insertNewItem = function () {\r\n            var newItem = {\r\n                title: self.title(),\r\n                description: self.description(),\r\n                dueDate: self.dueDate()\r\n            };\r\n            apiService.insertNewToDoItem(newItem)\r\n                .done(function (result) {\r\n                    if (result) {\r\n                        self.title(\"\");\r\n                        self.description(\"\");\r\n                        self.dueDate(moment().add(1, \"d\"));\r\n                        applicationBus.newToDoItemAdded.push(true);\r\n                    } else {\r\n                        applicationBus.newToDoItemAdded.error(new Bacon.Error(\"Error inserting a new ToDo item\"));\r\n                    }\r\n                })\r\n                .fail(function () {\r\n                    applicationBus.newToDoItemAdded.error(new Bacon.Error(\"Error inserting a new ToDo item\"));\r\n                });\r\n        };\r\n    };\r\n    webapp.NewToDoItemViewModel = function (apiService, applicationBus) {\r\n        return new ctor(apiService, applicationBus);\r\n    };\r\n    return webapp;\r\n}(this.webapp || {}));","this.webapp = (function (webapp) {\r\n    var ctor = function (apiService, applicationBus) {\r\n        var self = this,\r\n            loadItems;\r\n\r\n        self.items = ko.observableArray([]);\r\n        self.errorMessage = ko.observable(\"\");\r\n\r\n        loadItems = function () {\r\n            apiService.loadTodoItems()\r\n                .then(function (items) {\r\n                    self.items.removeAll();\r\n                    self.items(items);\r\n                })\r\n                .fail(function (error) {\r\n                    self.errorMessage(\"WARNING: an error has occurred loading items\");\r\n                });\r\n        };\r\n\r\n        applicationBus.newToDoItemAdded\r\n            .onValue(function () {\r\n                loadItems();\r\n            });\r\n\r\n        applicationBus.newToDoItemAdded\r\n            .onError(function (error) {\r\n                self.errorMessage(error.message);\r\n            });\r\n\r\n        self.init = function () {\r\n            self.errorMessage(\"\");\r\n            loadItems();\r\n        };\r\n    };\r\n    webapp.ToDoListViewModel = function (apiService, applicationBus) {\r\n        return new ctor(apiService, applicationBus);\r\n    };\r\n    return webapp;\r\n}(this.webapp || {}));","this.webapp = (function (webapp) {\r\n    jQuery(document).ready(function () {\r\n        var apiService = webapp.ApiService(),\r\n            applicationBus = webapp.ApplicationBus(),\r\n            viewModel = {\r\n                toDoList: webapp.ToDoListViewModel(apiService, applicationBus),\r\n                newToDoItem: webapp.NewToDoItemViewModel(apiService, applicationBus)\r\n            };\r\n        ko.applyBindings(viewModel);\r\n        viewModel.toDoList.init();\r\n    });\r\n    return webapp;\r\n}(this.webapp || {}));"]}